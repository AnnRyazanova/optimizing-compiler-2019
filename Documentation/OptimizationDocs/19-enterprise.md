# Разбиение трёхадресного кода на базовые блоки.

## Постановка задачи
Задача состояла в реализации поиска команд-лидеров, после чего реализации разбиения трёхадресного кода на базовые блоки.

## Команда — исполнитель
Enterprise

## Зависимости
Данная задача не зависит от других задач. 
От задачи зависит:
* задача построения графа потока управления

## Теория
Базовый блок – это максимальная последовательность команд трехадресного кода, удовлетворяющая следующим условиям:
* поток управления может входить в базовый блок только через первую команду
* управление покидает ББл без останова или ветвления, за
исключением, возможно, последней команды.

Для реализации алгоритма поиска базовых блоков необходимо сначала найти команды-лидеры. Команда называется лидером, если:
* эта команда первая
* на эту команду есть переход
* эта команда непосредственно следует за переходом.

Базовый блок каждого лидера определяется как содержащий самого лидера и все команды до (но не включая) следующего лидера или до конца программы.

## Реализация
В процессе реализации был создан класс, реализующий интерфейс _IEnumerable_. В данном классе присутствует метод, который ищет команды-лидеры. В нем происходит обход всего трехадресного кода, в ходе которого производятся несколько проверок:
```csharp
private HashSet<TacNode> FindLeaders(ThreeAddressCode RawTACode)
        {
            var previousGoto = false;
            var firstTAC = RawTACode.TACodeLines.First.Value;
            var leaderLabels = new HashSet<TacNode>{ firstTAC };

            foreach(var currentElement in RawTACode)
            {
                if (previousGoto)
                    leaderLabels.Add(currentElement);

                if (currentElement is TacGotoNode gotoNode)
                    leaderLabels.Add(RawTACode[gotoNode.TargetLabel]);

                previousGoto = currentElement is TacGotoNode;
            }
            return leaderLabels;
        }
```
Также данный класс содержит второй метод, непосредственно разбивающий трехадресный код на базовые блоки.
## Тесты
Трехадресный код исходной программы:
```
c=9
t2=c==c
a=t2
```
Полученные базовые блоки:
```
{
    c=9
    t2=c==c
    a=t2
}
```

Трехадресный код исходной программы:
```
a=123
t1=a>444
if t1 goto L1
goto L2
L1: g=34
L2:
```
Полученные базовые блоки:
```
{
    a=123
    t1=a>444
    if t1 goto L1
}
{goto L2}
{L1: g=34}
{L2: }
```

Трехадресный код исходной программы:
```
goto l7
g=34
l7:
```
Полученные базовые блоки:
```
{goto l7}
{g=34}
{l7: }
```

## Вывод
В результате работы был написан класс, который организует разбиение трехадресного кода на базовые блоки. Его работоспособность была успешно протестирована.
