# Передаточная функция базового блока В (Вычисление путем композиции)

## Постановка задачи
Задача состояла в реализации вычисления передаточной функции базового блока как композиции передаточных функций для каждой линии трёхадресного кода.

## Команда — исполнитель
Enterprise

## Зависимости
Данная задача зависит от 
- Генерации базовых блоков

От задачи зависит:
- Реализация итерационного алгоритма для достигающих определений

## Теория

Передаточная функция блока вычислялась как композиция передаточных функций для каждой линии трёхадресного кода. Формула для композиции передаточных функций выглядит следующим образом: 

`f1(X) = gen1 ∪ (X − kill1), f2(X) = gen2 ∪ (X − kill2) `

тогда 

`f2(f1(X)) = gen2 ∪ (gen1 ∪ (X − kill1) − kill2) =
= gen2 ∪ (gen1 − kill2) ∪ (X − (kill1 ∪ kill2))`

## Реализация
В процессе решения задачи был создан класс, реализующий интерфейс _ITransmissionFunction_. В нем присутствует метод, принимающий на вход множество `in` и сам блок, для которого нужно вычислить передаточную функцию. Далее происходит обход всех линий трехадресного кода в блоке и подсчет передаточной функции для блока:
```csharp
public HashSet<TacNode> Calculate(HashSet<TacNode> _in, ThreeAddressCode bblock)
        {
            basicBlock = bblock;
            var func = _in;

            foreach (var line in GetBasicBlock())
            {
                var gen = new HashSet<TacNode>();
                gen.UnionWith(GetLineGen(line));

                var kill = new HashSet<TacNode>();
                kill.UnionWith(GetLineKill(line));

                var exceptKill = new HashSet<TacNode>();
                exceptKill.UnionWith(func);

                exceptKill.ExceptWith(kill);

                gen.UnionWith(exceptKill);

                func = new HashSet<TacNode>();
                func.UnionWith(gen);
            }

            return func;
        }
```

## Тесты
Входные блоки:
```
B1:
    i=m-1
    j=n
    a=u1
B2:
    i=i+1
    j=j-1
B3:
    a=u2
B4:
    i=u3
```
Вывод передаточной функции для B1:
```
    i=m-1
    j=n
    a=u1
```
Вывод передаточной функции для B2:
```
    i=i+1
    j=j-1
```
Вывод передаточной функции для B4:
```
    i=u3
```   

## Вывод
В результате работы был написан класс, который вычисляет передаточную функцию для базового блока как композицию передаточных функций для каждой линии трехадресного кода. Его работоспособность была успешно протестирована.
